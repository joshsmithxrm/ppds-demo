# =============================================================================
# Composite Action: Setup PAC CLI
# =============================================================================
# Installs .NET SDK and Power Platform CLI for use in workflows.
#
# Usage:
#   - name: Setup PAC CLI
#     uses: ./.github/actions/setup-pac-cli
#
# =============================================================================

name: 'Setup PAC CLI'
description: 'Install .NET SDK and Power Platform CLI'

inputs:
  dotnet-version:
    description: '.NET SDK version to install'
    required: false
    default: '8.x'

outputs:
  pac-version:
    description: 'Installed PAC CLI version'
    value: ${{ steps.install.outputs.version }}

runs:
  using: 'composite'
  steps:
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: ${{ inputs.dotnet-version }}

    - name: Install Power Platform CLI
      id: install
      shell: bash
      run: |
        dotnet tool install --global Microsoft.PowerApps.CLI.Tool
        echo "$HOME/.dotnet/tools" >> $GITHUB_PATH

        # Get installed version
        VERSION=$(dotnet tool list --global | grep -i "microsoft.powerapps.cli.tool" | awk '{print $2}')
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Installed PAC CLI version: $VERSION"
